# 데이터베이스 트랜잭션 가이드

## 목차
1. [트랜잭션 개요](#트랜잭션-개요)
2. [ACID 속성](#acid-속성)
3. [트랜잭션 상태](#트랜잭션-상태)
4. [트랜잭션 제어 명령어](#트랜잭션-제어-명령어)
5. [트랜잭션 격리 수준](#트랜잭션-격리-수준)
6. [동시성 문제](#동시성-문제)
7. [트랜잭션 관리 기법](#트랜잭션-관리-기법)

## 트랜잭션 개요

트랜잭션은 데이터베이스의 상태를 변화시키는 하나의 논리적 작업 단위입니다. 데이터베이스의 일관성을 보장하기 위해 여러 작업을 하나의 작업처럼 처리하는 기능을 제공합니다.

예를 들어, 은행 계좌 이체의 경우:
1. A 계좌에서 돈을 출금
2. B 계좌로 돈을 입금

이 두 작업은 반드시 모두 성공하거나 모두 실패해야 합니다.

## ACID 속성

트랜잭션은 다음 네 가지 주요 특성을 보장해야 합니다:

### Atomicity (원자성)
- 트랜잭션의 모든 연산이 완전히 수행되거나 전혀 수행되지 않아야 함
- 부분적 실행은 허용되지 않음

### Consistency (일관성)
- 트랜잭션 실행 전과 후의 데이터베이스는 일관된 상태를 유지해야 함
- 데이터베이스의 제약조건이 항상 만족되어야 함

### Isolation (격리성)
- 동시에 실행되는 트랜잭션들이 서로 영향을 미치지 않아야 함
- 각 트랜잭션은 다른 트랜잭션의 연산 결과를 볼 수 없음

### Durability (지속성)
- 성공적으로 완료된 트랜잭션의 결과는 영구적으로 반영되어야 함
- 시스템 장애가 발생하더라도 데이터는 보존되어야 함

## 트랜잭션 상태

트랜잭션은 다음과 같은 상태를 가집니다:

### Active (활동)
- 트랜잭션이 실행 중인 상태
- 읽기와 쓰기 연산 수행 가능

### Partially Committed (부분 완료)
- 마지막 연산이 실행된 직후의 상태
- 아직 데이터베이스에 완전히 반영되지 않은 상태

### Committed (완료)
- 트랜잭션이 성공적으로 완료된 상태
- 변경사항이 데이터베이스에 영구적으로 반영됨

### Failed (실패)
- 트랜잭션 실행 중 오류가 발생한 상태
- 복구가 필요한 상태

### Aborted (철회)
- 트랜잭션이 취소된 상태
- 데이터베이스가 트랜잭션 시작 전 상태로 회복됨

## 트랜잭션 제어 명령어

### COMMIT
- 트랜잭션의 모든 변경사항을 데이터베이스에 영구적으로 반영
- 실행 예: `COMMIT;`

### ROLLBACK
- 트랜잭션의 모든 변경사항을 취소하고 이전 상태로 복구
- 실행 예: `ROLLBACK;`

### SAVEPOINT
- 트랜잭션 내에 중간 저장점을 생성
- 실행 예: `SAVEPOINT savepoint_name;`

## 트랜잭션 격리 수준

### READ UNCOMMITTED
- 가장 낮은 격리 수준
- 다른 트랜잭션의 커밋되지 않은 데이터 읽기 가능
- Dirty Read 발생 가능

### READ COMMITTED
- 커밋된 데이터만 읽기 가능
- Non-Repeatable Read 발생 가능

### REPEATABLE READ
- 트랜잭션 내에서 같은 데이터를 여러 번 읽어도 동일한 결과 보장
- Phantom Read 발생 가능

### SERIALIZABLE
- 가장 높은 격리 수준
- 완벽한 트랜잭션 격리 보장
- 성능 저하가 발생할 수 있음

### SERIALIZABLE VS REPEATABLE

![Image](https://github.com/user-attachments/assets/7985ee99-4d86-4383-911c-b3f2a9db3632)

![Image](https://github.com/user-attachments/assets/6cd199ee-ea86-402e-9752-dcf9d51e5c7f)
## 동시성 문제

### Dirty Read
- 커밋되지 않은 데이터를 다른 트랜잭션이 읽는 현상
- 데이터 정합성 문제 발생 가능

### Non-Repeatable Read
- 한 트랜잭션 내에서 같은 데이터를 여러 번 읽을 때 다른 결과가 나타나는 현상
- 다른 트랜잭션의 UPDATE로 인해 발생

### Phantom Read
- 한 트랜잭션 내에서 같은 쿼리를 여러 번 실행할 때 결과 집합이 다른 현상
- 다른 트랜잭션의 INSERT/DELETE로 인해 발생

## 트랜잭션 관리 기법

### 락킹 (Locking)
- 동시성 제어를 위한 기본적인 방법
- 공유 락(Shared Lock)과 배타적 락(Exclusive Lock) 사용
- 데드락 발생 가능성 있음

### 타임스탬프 기반 프로토콜
- 각 트랜잭션에 고유한 타임스탬프 부여
- 시간 순서에 따라 트랜잭션 실행

### 낙관적 동시성 제어
- 충돌이 적다고 가정
- 검증 단계에서 충돌 확인
- 충돌 시 롤백 수행

이 문서는 데이터베이스 트랜잭션의 기본 개념부터 고급 주제까지 포괄적으로 다루고 있습니다. 추가적인 정보나 특정 주제에 대한 더 자세한 설명이 필요하시다면 말씀해 주시기 바랍니다.