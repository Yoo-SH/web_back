# DB 복합 인덱스와 성능 개선을 위한 인덱스 결합

## 1. 복합 인덱스 (Composite Index)

### 1.1 복합 인덱스란?
복합 인덱스(Composite Index)는 두 개 이상의 컬럼을 하나의 인덱스로 구성하여 쿼리 성능을 향상시키는 인덱스 유형입니다. 단일 인덱스보다 검색 속도를 개선할 수 있으며, WHERE 절이나 ORDER BY에서 여러 컬럼을 조합하여 사용할 때 유용합니다.

### 1.2 복합 인덱스의 장점
- **검색 성능 향상**: 다중 컬럼을 한 번에 검색할 수 있어 효율적입니다.
- **정렬 비용 절감**: ORDER BY 시 인덱스를 활용하여 정렬 비용을 줄일 수 있습니다.
- **인덱스 스캔 최적화**: 다중 컬럼을 포함하는 조건 검색에서 단일 컬럼 인덱스보다 빠르게 처리됩니다.

### 1.3 복합 인덱스의 단점
- **인덱스 크기 증가**: 인덱스 크기가 커질수록 관리 비용이 증가할 수 있습니다.
- **쓰기 성능 저하**: INSERT, UPDATE, DELETE 연산 시 인덱스 유지 비용이 증가할 수 있습니다.
- **컬럼 순서 중요**: 인덱스 생성 시 컬럼 순서에 따라 활용 효율이 달라집니다.

### 1.4 복합 인덱스 활용 예시
```sql
-- 복합 인덱스 생성 (사용자 ID + 생성 날짜)
CREATE INDEX idx_user_created_at ON users (user_id, created_at);

-- 복합 인덱스가 활용되는 경우
SELECT * FROM users WHERE user_id = 123 AND created_at > '2024-01-01';

-- 인덱스가 부분적으로 활용되는 경우 (user_id를 조건으로 먼저 사용해야 최적화됨)
SELECT * FROM users WHERE created_at > '2024-01-01';  -- 인덱스 효율적 사용 X
```

## 2. 성능 개선을 위한 인덱스 결합 (Index Merge)

### 2.1 인덱스 결합이란?
인덱스 결합(Index Merge)은 여러 개의 단일 컬럼 인덱스를 조합하여 최적의 실행 계획을 수립하는 기법입니다. MySQL과 같은 일부 DBMS에서 지원하며, 특정 조건에서 복합 인덱스를 생성하는 대신 여러 개의 단일 인덱스를 활용할 수 있도록 합니다.

### 2.2 인덱스 결합 방식
- **Union 방식**: 여러 인덱스를 사용하여 각각의 결과를 얻고, 이를 합친 후 중복을 제거하는 방식.
- **Intersection 방식**: 여러 인덱스의 결과를 교집합으로 결합하여 최적의 결과를 도출하는 방식.
- **Sort-Union 방식**: 정렬된 인덱스를 병합하여 결과를 반환하는 방식.

### 2.3 인덱스 결합 활용 예시
```sql
-- 단일 컬럼 인덱스 생성
CREATE INDEX idx_user_id ON users (user_id);
CREATE INDEX idx_created_at ON users (created_at);

-- 인덱스 결합 활용 쿼리 (MySQL 기준, Index Merge 가능)
SELECT * FROM users WHERE user_id = 123 OR created_at > '2024-01-01';
```

### 2.4 인덱스 결합의 장단점
#### 장점
- **복합 인덱스 없이도 최적화 가능**: 여러 개의 단일 인덱스를 활용하여 특정 쿼리를 최적화할 수 있습니다.
- **유연한 활용 가능**: 복합 인덱스를 만들지 않고도 다양한 조합을 처리할 수 있습니다.

#### 단점
- **DB 엔진에 따라 지원 여부가 다름**: MySQL에서는 Index Merge를 지원하지만, 모든 DBMS에서 동일한 방식으로 동작하지 않을 수 있습니다.
- **복합 인덱스보다 비효율적일 수 있음**: 특정 경우에는 복합 인덱스보다 성능이 떨어질 수 있습니다.

## 3. 복합 인덱스 vs 인덱스 결합 선택 기준
| 기준 | 복합 인덱스 | 인덱스 결합 |
|------|------------|------------|
| 검색 성능 | 빠름 | 경우에 따라 다름 |
| 인덱스 크기 | 큼 | 작음 (여러 개의 단일 인덱스 활용) |
| 정렬 최적화 | ORDER BY 최적화 가능 | 정렬 비용 증가 가능 |
| WHERE 조건 조합 | 특정 컬럼 순서에 따라 최적화 | 다양한 조합에 유연하게 대응 |
| DB 엔진 지원 | 대부분 지원 | 일부 DBMS에서만 지원 |

## 4. 최적의 인덱스 설계 전략
1. **쿼리 패턴 분석**: 자주 실행되는 쿼리를 분석하여 가장 효율적인 인덱스 구조를 결정합니다.
2. **복합 인덱스 활용**: WHERE 절에 자주 등장하는 컬럼 조합을 고려하여 적절한 순서로 복합 인덱스를 생성합니다.
3. **인덱스 결합 고려**: 특정 상황에서 복합 인덱스 대신 단일 컬럼 인덱스를 결합하여 활용할 수 있는지 검토합니다.
4. **인덱스 크기와 성능 균형 유지**: 불필요한 인덱스는 삭제하고, 테이블 크기 증가를 방지합니다.
5. **실제 실행 계획(EXPLAIN) 확인**: `EXPLAIN`을 사용하여 인덱스가 예상대로 동작하는지 검토합니다.

## 5. 참고 명령어
```sql
-- 인덱스 목록 확인 (MySQL)
SHOW INDEX FROM users;

-- 실행 계획 확인
EXPLAIN SELECT * FROM users WHERE user_id = 123 AND created_at > '2024-01-01';
```

## 6. 결론
- 복합 인덱스는 특정 컬럼 조합의 검색 성능을 극대화하지만, 컬럼 순서와 크기를 신중히 고려해야 합니다.
- 인덱스 결합은 다양한 조건에서 유연하게 활용할 수 있으나, 모든 DBMS에서 최적화되는 것은 아닙니다.
- 최적의 성능을 위해서는 쿼리 패턴을 분석하고, 실행 계획을 검토한 후 적절한 인덱스 전략을 선택하는 것이 중요합니다.
