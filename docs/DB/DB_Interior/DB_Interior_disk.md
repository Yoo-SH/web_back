# 데이터베이스 저장 구조 분석
*데이터베이스의 테이블과 인덱스가 디스크에 저장되는 방식에 대한 포괄적인 가이드*

## 목차
1. [테이블 저장 구조](#테이블-저장-구조)
2. [인덱스 저장 구조](#인덱스-저장-구조)
3. [디스크 I/O와 버퍼 관리](#디스크-IO와-버퍼-관리)
4. [스토리지 엔진별 특징](#스토리지-엔진별-특징)

## 테이블 저장 구조

### 페이지(Page) 구조
- 데이터베이스는 디스크에 데이터를 저장할 때 페이지(또는 블록)라는 고정 크기의 단위를 사용합니다
- 일반적인 페이지 크기는 4KB, 8KB, 16KB 등이며 DBMS마다 다릅니다
- 각 페이지는 헤더, 데이터 영역, 포인터 등으로 구성됩니다

### 테이블스페이스
- 테이블과 인덱스가 저장되는 논리적인 저장 공간입니다
- 하나 이상의 데이터 파일로 구성됩니다
- 자동 확장 및 관리가 가능합니다

### 데이터 파일 구조
- 데이터 파일은 세그먼트, 익스텐트, 페이지의 계층 구조를 가집니다
- 세그먼트: 테이블이나 인덱스와 같은 객체를 저장하는 논리적 단위
- 익스텐트: 연속된 페이지들의 집합
- 페이지: 실제 데이터가 저장되는 최소 단위


![Image](https://github.com/user-attachments/assets/57f61bc0-7bbc-4c5e-9194-b73f37cf1705)
![Image](https://github.com/user-attachments/assets/ec0d13fa-da33-42e2-bf64-06a7205addb5)
![Image](https://github.com/user-attachments/assets/f310433a-e310-4fcd-91fa-a341fe14ef03)
## 인덱스 저장 구조

### B-Tree 인덱스
- 가장 일반적인 인덱스 구조입니다
- 루트 노드, 브랜치 노드, 리프 노드로 구성됩니다
- 각 노드는 디스크의 페이지에 매핑됩니다
- 리프 노드는 실제 데이터 레코드를 가리키는 포인터를 저장합니다

### 인덱스 페이지 구조
- 키 값과 포인터로 구성됩니다
- 정렬된 상태를 유지합니다
- 노드 분할과 병합을 통해 밸런스를 유지합니다

### 클러스터드 인덱스
- 테이블의 물리적 저장 순서를 결정합니다
- 테이블당 하나만 가질 수 있습니다
- 보조 인덱스는 클러스터드 인덱스 키를 참조합니다

## 디스크 I/O와 버퍼 관리

### 버퍼 풀
- 디스크 I/O를 최소화하기 위한 메모리 영역입니다
- LRU(Least Recently Used) 알고리즘으로 관리됩니다
- 더티 페이지는 주기적으로 디스크에 기록됩니다

### 페이지 읽기/쓰기
- 랜덤 I/O vs 시퀀셜 I/O
- 페이지 미리읽기(Prefetch)
- Write-Ahead Logging (WAL)
- 체크포인트 수행

## 스토리지 엔진별 특징

### InnoDB (MySQL)
- 클러스터드 인덱스 기반 구조
- MVCC(Multi-Version Concurrency Control) 지원
- 트랜잭션 및 외래 키 지원
- 버퍼 풀을 통한 캐시 관리

### MyISAM (MySQL)
- 힙 파일 구조
- 테이블 수준의 잠금
- 인덱스는 별도 파일로 저장
- 키 캐시를 통한 인덱스 캐싱

### PostgreSQL
- 힙 파일 구조
- MVCC 지원
- TOAST(The Oversized-Attribute Storage Technique) 사용
- 공유 버퍼를 통한 캐시 관리

## 성능 최적화 고려사항

1. 테이블 구조 설계
    - 적절한 데이터 타입 선택
    - 정규화 수준 결정
    - 파티셔닝 전략 수립

2. 인덱스 설계
    - 선택도(Selectivity) 고려
    - 복합 인덱스 순서 최적화
    - 인덱스 크기와 유지보수 비용 고려

3. 저장 공간 관리
    - 테이블스페이스 크기 계획
    - 자동 확장 설정
    - 디스크 공간 모니터링

4. I/O 최적화
    - 버퍼 풀 크기 조정
    - 페이지 크기 최적화
    - 디스크 레이아웃 고려

이 문서는 데이터베이스의 물리적 저장 구조에 대한 기본적인 이해를 제공합니다. 실제 구현은 데이터베이스 관리 시스템(DBMS)마다 다를 수 있으며, 특정 DBMS의 문서를 참조하시기 바랍니다.